<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- Minimal initial meta tags, populated dynamically -->
    <meta name="description" content="" />
    <meta property="og:title" content="" />
    <meta property="og:description" content="" />
    <meta property="og:image" content="https://www.manuplast.co/images/logo.png" />
    <meta property="og:url" content="https://www.manuplast.co/type-detail.html" />
    <meta property="og:type" content="product" />
    <meta property="og:site_name" content="manuplast" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="" />
    <meta name="twitter:description" content="" />
    <meta name="twitter:image" content="https://www.manuplast.co/images/logo.png" />
    <title></title>
    <link href="style.css" rel="stylesheet" />
    <link rel="icon" type="image/png" href="./images/logo.png" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
    />
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer>
      // Deferred script to pre-fetch meta tags as early as possible
      (function () {
        const params = new URLSearchParams(window.location.search);
        const typeId = params.get("id");
        const categoryId = params.get("category_id");

        if (typeId && categoryId) {
          fetch(
            `https://api.vybtek.com/api/manuplast/producttypes/${typeId}`,
            {
              headers: {
                Authorization: `Bearer ${localStorage.getItem("token") || ""}`,
              },
              timeout: 1500, // Further reduced to 1.5 seconds
            }
          )
            .then((response) => {
              if (!response.ok) throw new Error("Network response was not ok");
              return response.json();
            })
            .then((product) => {
              const truncateDescription = (desc, maxLength = 160) => {
                if (!desc || typeof desc !== "string") return "";
                const cleanDesc = desc.replace(/\r\n/g, " ").trim();
                if (cleanDesc.length <= maxLength) return cleanDesc;
                const truncated = cleanDesc.substring(0, maxLength);
                return truncated.substring(0, truncated.lastIndexOf(" ")) + "...";
              };

              const descriptionText = truncateDescription(product.description);
              document.title = product.name ? `${product.name} - Manuplast` : "";

              // Ensure meta tags exist and update them
              let metaDescription = document.querySelector('meta[name="description"]');
              if (!metaDescription) {
                metaDescription = document.createElement("meta");
                metaDescription.name = "description";
                document.head.appendChild(metaDescription);
              }
              metaDescription.setAttribute("content", descriptionText);

              let ogTitle = document.querySelector('meta[property="og:title"]');
              if (!ogTitle) {
                ogTitle = document.createElement("meta");
                ogTitle.setAttribute("property", "og:title");
                document.head.appendChild(ogTitle);
              }
              ogTitle.setAttribute(
                "content",
                product.name ? `${product.name} - manuplast` : ""
              );

              let ogDescription = document.querySelector('meta[property="og:description"]');
              if (!ogDescription) {
                ogDescription = document.createElement("meta");
                ogDescription.setAttribute("property", "og:description");
                document.head.appendChild(ogDescription);
              }
              ogDescription.setAttribute("content", descriptionText);

              document
                .querySelector('meta[property="og:image"]')
                ?.setAttribute(
                  "content",
                  product.cover_image_url ||
                    "https://www.manuplast.co/images/logo.png"
                );
              document
                .querySelector('meta[property="og:url"]')
                ?.setAttribute("content", window.location.href);

              let twitterTitle = document.querySelector('meta[name="twitter:title"]');
              if (!twitterTitle) {
                twitterTitle = document.createElement("meta");
                twitterTitle.setAttribute("name", "twitter:title");
                document.head.appendChild(twitterTitle);
              }
              twitterTitle.setAttribute(
                "content",
                product.name ? `${product.name} - manuplast` : ""
              );

              let twitterDescription = document.querySelector('meta[name="twitter:description"]');
              if (!twitterDescription) {
                twitterDescription = document.createElement("meta");
                twitterDescription.setAttribute("name", "twitter:description");
                document.head.appendChild(twitterDescription);
              }
              twitterDescription.setAttribute("content", descriptionText);

              document
                .querySelector('meta[name="twitter:image"]')
                ?.setAttribute(
                  "content",
                  product.cover_image_url ||
                    "https://www.manuplast.co/images/logo.png"
                );

              const schemaScript = document.querySelector(
                'script[type="application/ld+json"]'
              );
              if (schemaScript && product.name) {
                const schemaData = {
                  "@context": "https://schema.org",
                  "@type": "Product",
                  name: product.name || "",
                  image:
                    product.cover_image_url ||
                    "https://www.manuplast.co/images/logo.png",
                  description: descriptionText || "",
                  sku: product.id || "PRODUCT123",
                  mpn: product.id || "MPN123",
                  brand: { "@type": "Brand", name: "manuplast" },
                  offers: {
                    "@type": "Offer",
                    url: window.location.href,
                    priceCurrency: "INR",
                    price: product.price
                      ? parseFloat(product.price.replace(/[^\d.]/g, ""))
                      : "0.00",
                    priceValidUntil: "2026-07-22",
                    availability:
                      product.status === "active"
                        ? "https://schema.org/InStock"
                        : "https://schema.org/OutOfStock",
                    seller: { "@type": "Organization", name: "manuplast" },
                  },
                };
                schemaScript.textContent = JSON.stringify(schemaData, null, 2);
              }
            })
            .catch((error) => {
              console.error("Pre-fetch error:", error);
            });
        }
      })();
    </script>
    <script src="headerFooter.js"></script>
    <script src="products.js"></script>
    <script defer src="whatsapp.js"></script>
    <style>
      @keyframes slideIn {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      .sticky {
        position: sticky;
        top: 20px;
      }
      .thumbnail:hover {
        transform: scale(1.1);
        transition: transform 0.3s ease;
      }
      .color-swatch:hover {
        transform: scale(1.1);
        transition: transform 0.3s ease;
      }
      .tab-active {
        border-bottom: 2px solid #3b82f6;
        color: #3b82f6;
      }
      @media (max-width: 640px) {
        .related-product-card {
          width: 100%;
          max-width: 300px;
          margin-left: auto;
          margin-right: auto;
        }
        .related-products-grid {
          display: flex;
          flex-direction: column;
          align-items: center;
        }
      }
    </style>
  </head>

  <body>
    <!-- Header -->
    <special-header></special-header>

    <section class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
      <div id="type-detail" class="text-center"></div>
    </section>

    <!-- Footer -->
    <special-footer></special-footer>
  </body>
</html>